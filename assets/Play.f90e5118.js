import{d as q,z,m as D,n as I,c,q as p,e as t,a as L,w as O,T as R,p as H,b as J,o as i,g as u,A as C,v as g,t as r,F as G,s as K,B as Q,y as W}from"./vendor.8a3ab317.js";import{S as $}from"./sweetalert2.314ae3be.js";import{e as S}from"./api.a6e8cdff.js";import{_ as X}from"./index.77b72fb4.js";const h=m=>(H("data-v-183205a2"),m=m(),J(),m),Y={id:"play"},Z={id:"container"},ee=h(()=>t("div",{id:"safe-area",class:"w-full my-3"},null,-1)),te={id:"wrapper"},se={key:0},ae=h(()=>t("h1",{style:{"font-size":"1.6rem"}},"\u52A0\u5165\u904A\u6232",-1)),le={class:"ch"},ne=h(()=>t("label",{class:"ch-label"},"\u904A\u6232 ID",-1)),ue={key:1},oe=h(()=>t("h1",{style:{"font-size":"1.6rem"}},"\u904A\u6232\u8CC7\u8A0A",-1)),ce={class:"ch"},ie={class:"ch-label text-lg"},re={class:"ch-label text-md"},de={class:"ch"},he={class:"ch-label text-lg"},_e={class:"ch"},pe=h(()=>t("label",{class:"ch-label"},"\u8F38\u5165\u73A9\u5BB6\u540D\u7A31",-1)),ge=h(()=>t("label",{class:"ch-label"},"\u9078\u64C7\u968A\u4F0D\u540D\u7A31",-1)),me=["value"],fe={key:2},ve={class:"text-3xl"},Ae={class:"ch"},Fe={class:"ch-label text-lg"},De={key:0,class:"ch"},Be={class:"ch-label text-lg"},Ce={class:"ch-label text-lg"},ye={key:1,class:"ch"},be=h(()=>t("p",{class:"ch-label text-lg"},"\u8ACB\u8F38\u5165\u6307\u5B9A\u5BC6\u78BC",-1)),Ee=q({setup(m){function _(l,e=""){$.fire({title:l,text:e,icon:"error",confirmButtonText:"\u78BA\u5B9A"})}function y(l,e=""){$.fire({title:l,text:e,icon:"success",confirmButtonText:"\u78BA\u5B9A"})}const b=z(),d=D(0),s=I({id:""});if(location.search.includes("?id=")){const l=location.search.split("?id=")[1];s.id=l}const a=I({name:"",team:"",challenge:0,start:0}),f=D(""),v=D(""),B=D(0);function j(){if(s.id.length===0){_("\u8ACB\u8F38\u5165\u904A\u6232 ID");return}const l=`${S}/get?id=${s.id}`;fetch(l).then(e=>e.json()).then(async e=>{if(e.name){for(const n in e)s[n]=e[n];console.log(s),d.value=1}else _("\u52A0\u5165\u5931\u6557","\u8ACB\u78BA\u8A8D\u904A\u6232 ID \u662F\u5426\u6B63\u78BA")})}function V(){var l;if(a.name.length===0){_("\u8ACB\u8F38\u5165\u73A9\u5BB6\u540D\u7A31");return}if(((l=s.teams)==null?void 0:l.length)>0&&a.team.length===0){_("\u8ACB\u9078\u64C7\u968A\u4F0D");return}a.start=Date.now(),console.log(s,a),d.value=2,B.value=setInterval(async()=>{const e=await T();console.log(e),v.value=`${e.coords.latitude}, ${e.coords.longitude}`},3e3)}function P(){if(s.challenges[a.challenge].mode===0){const l=+s.challenges[a.challenge].gps.split(",")[0].trim(),e=+s.challenges[a.challenge].gps.split(",")[1].trim(),n=+v.value.split(",")[0].trim(),F=+v.value.split(",")[1].trim(),o=Math.floor(N(l,e,n,F));console.log(o),o<=200?(a.challenge++,a.challenge>=s.challenges.length&&(y("\u606D\u559C\u4F60\u904E\u95DC\u4E86","\u6210\u7E3E\uFF1A"+x(Math.floor((Date.now()-a.start)/1e3))),d.value=0,E().then(()=>{b.push("/ranking?id="+s.id)}),clearInterval(B.value))):_("\u4E0D\u5728\u6307\u5B9A\u4F4D\u7F6E\u9644\u8FD1",`\u76EE\u524D\u8DDD\u96E2 ${o} \u516C\u5C3A`)}else f.value===s.challenges[a.challenge].secret?(a.challenge++,f.value="",a.challenge>=s.challenges.length&&(y("\u606D\u559C\u4F60\u904E\u95DC\u4E86","\u6210\u7E3E\uFF1A"+x(Math.floor((Date.now()-a.start)/1e3))),d.value=0,E().then(()=>{b.push("/ranking?id="+s.id)}),clearInterval(B.value))):_("\u5BC6\u78BC\u932F\u8AA4")}function T(){return new Promise((l,e)=>{navigator.geolocation.getCurrentPosition(n=>{l(n)},n=>{e(n)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:0})})}function N(l,e,n,F){const o=6371,w=A(n-l),M=A(F-e),k=Math.sin(w/2)*Math.sin(w/2)+Math.cos(A(l))*Math.cos(A(n))*Math.sin(M/2)*Math.sin(M/2),U=2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k));return o*U*1e3}function A(l){return l*(Math.PI/180)}async function E(){await fetch(`${S}/ranking/add`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:s.id,name:a.name,team:a.team,time:Math.floor((Date.now()-a.start)/1e3)})}).then(l=>l.ok)}function x(l){const e=Math.floor(l/3600),n=Math.floor((l-e*3600)/60);let o=`${l-e*3600-n*60} \u79D2`;return n>0&&(o=`${n} \u5206 ${o}`),e>0&&(o=`${e} \u5C0F\u6642 ${o}`),o}return(l,e)=>(i(),c("div",Y,[p(t("div",Z,[ee,t("div",te,[L(R,{name:"fade",mode:"out-in"},{default:O(()=>[t("div",null,[d.value===0?(i(),c("div",se,[ae,t("div",le,[ne,p(t("input",{class:"ch-input","onUpdate:modelValue":e[0]||(e[0]=n=>u(s).id=n),placeholder:"abc123"},null,512),[[C,u(s).id]]),t("a",{onClick:j,href:"javascript:void(0)",class:"w-full inline-block"},"\u52A0\u5165")])])):g("",!0),d.value===1?(i(),c("div",ue,[oe,t("div",ce,[t("p",ie,r(u(s).name),1),t("p",re,r(u(s).description),1)]),t("div",de,[t("p",he,"\u95DC\u5361\u6578\uFF1A "+r(u(s).challenges.length),1)]),t("div",_e,[pe,p(t("input",{class:"ch-input","onUpdate:modelValue":e[1]||(e[1]=n=>u(a).name=n),placeholder:"player"},null,512),[[C,u(a).name]]),ge,p(t("select",{class:"ch-input","onUpdate:modelValue":e[2]||(e[2]=n=>u(a).team=n)},[(i(!0),c(G,null,K(u(s).teams,n=>(i(),c("option",{value:n},r(n),9,me))),256))],512),[[Q,u(a).team]]),t("button",{onClick:V},"\u958B\u59CB\u904A\u6232")])])):g("",!0),d.value===2?(i(),c("div",fe,[t("h1",ve,r(u(s).challenges[u(a).challenge].name),1),t("div",Ae,[t("p",Fe,r(u(s).challenges[u(a).challenge].description),1)]),u(s).challenges[u(a).challenge].mode===0?(i(),c("div",De,[t("p",Be,"\u8ACB\u79FB\u52D5\u81F3\u6307\u5B9A\u4F4D\u7F6E\uFF1A "+r(u(s).challenges[u(a).challenge].gps),1),t("p",Ce,"\u73FE\u5728\u4F4D\u7F6E\uFF1A "+r(v.value||"\u53D6\u5F97\u4F4D\u7F6E\u4E2D..."),1)])):g("",!0),u(s).challenges[u(a).challenge].mode===1?(i(),c("div",ye,[be,p(t("input",{class:"ch-input","onUpdate:modelValue":e[3]||(e[3]=n=>f.value=n),placeholder:"password"},null,512),[[C,f.value]])])):g("",!0),t("div",{class:"ch"},[t("button",{onClick:P},"\u4E0B\u4E00\u95DC")])])):g("",!0)])]),_:1})])],512),[[W,!0]])]))}});var $e=X(Ee,[["__scopeId","data-v-183205a2"]]);export{$e as default};
